<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> mongodb安装教程 · Hexo</title><meta name="description" content="mongodb安装教程 - Oneday"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Hexo"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">mongodb安装教程</h1><div class="post-info">Apr 2, 2017</div><div class="post-content"><p>记录mongodb安装过程中踩过的几个坑，以及在NodeJs里面的用法<br><a id="more"></a></p>
<p>最近在入门mongodb，期间踩了不少坑，在这里记录一下。</p>
<h2 id="系统及mongodb版本"><a href="#系统及mongodb版本" class="headerlink" title="系统及mongodb版本"></a>系统及mongodb版本</h2><ol>
<li>系统：OS X</li>
<li>mongodb版本： 3.4 Community Edition</li>
</ol>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装方式有两种，一种是直接在官网下载安装包，然后解压，最后还需要设置PATH，比较麻烦，这里推荐的是第二种按照方式：<a href="https://brew.sh/" target="_blank" rel="external">Homebrew</a>，安装成功之后会自动帮我们设置好PATH，非常方便</p>
<p>使用Homebrew安装<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install mongodb</div></pre></td></tr></table></figure></p>
<p>安装完成之后我们需要创建一个提供给mongodb存储数据的文件夹，mongodb默认使用的文件夹是 /data/db，我们先来创建一个：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -p /data/db</div></pre></td></tr></table></figure></p>
<p>如果你想使用其他路径文件夹来存储数据可以在启动命令的时候加上dbpath来指定所需要使用的目录路径：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod --dbpath &lt;path to data directory&gt;</div></pre></td></tr></table></figure></p>
<h2 id="启动mongodb服务器"><a href="#启动mongodb服务器" class="headerlink" title="启动mongodb服务器"></a>启动mongodb服务器</h2><p>接下来我们来启动mongodb的服务，在控制台输入<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod</div></pre></td></tr></table></figure></p>
<p><img src="/mongodb-install/1.png" alt=""><br>yes，启动成功！<br>从控制台上打印出来的日志我们可以看到mongodb默认的端口号是27017，dbpath=/data/db，我们可以注意到日志中有一行这样的warning信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2017-04-02T18:46:54.942+0800 I CONTROL  [initandlisten] ** WARNING: Access control is not enabled for the database.</div></pre></td></tr></table></figure></p>
<blockquote>
<p>直接使用mongod命令启动的是 <strong>没有进行访问控制</strong> 的访问方式，即可以不用登录就能访问所有数据库</p>
</blockquote>
<p>接下来我们使用需要进行访问控制的启动方式，在这之前我们需要先创建一个角色，mongodb提供了mongo来启动mongodb的客户端</p>
<blockquote>
<p><strong>mongod</strong> 是mongodb的服务端启动命令<br><strong>mongo</strong>是mongodb的客户端启动命令</p>
</blockquote>
<h2 id="启动mongodb客户端："><a href="#启动mongodb客户端：" class="headerlink" title="启动mongodb客户端："></a>启动mongodb客户端：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongo</div></pre></td></tr></table></figure>
<p><img src="/mongodb-install/2.png" alt=""><br>在这我们可以输入mongodb的命令来操作数据库，ok，我们现在来创建一个角色：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">use admin // 使用admin数据库</div><div class="line">db.createUser(</div><div class="line">  &#123;</div><div class="line">    user: &quot;myUserAdmin&quot;,</div><div class="line">    pwd: &quot;abc123&quot;,</div><div class="line">    roles: [ &#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125; ]</div><div class="line">  &#125;</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>创建成功，关闭mongodb服务器和客户端，用访问控制的方式启动服务器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mongod --auth // 以访问控制的方式启动服务器</div><div class="line">mongo // 启动客户端</div></pre></td></tr></table></figure></p>
<p>在客户端进行登录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">use admin // 使用admin数据库</div><div class="line">db.auth(&quot;myUserAdmin&quot;, &quot;abc123&quot;)</div></pre></td></tr></table></figure></p>
<h2 id="在NodeJs使用mongodb"><a href="#在NodeJs使用mongodb" class="headerlink" title="在NodeJs使用mongodb"></a>在NodeJs使用mongodb</h2><p>首先我们需要在NodeJs里面安装mongodb的驱动<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install mongodb --save</div></pre></td></tr></table></figure></p>
<p>使用方式很简单，在app.js里面添加以下代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> MongoClient = <span class="built_in">require</span>(<span class="string">'mongodb'</span>).MongoClient</div><div class="line">  , assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Connection URL</span></div><div class="line"><span class="keyword">const</span> url = <span class="string">'mongodb://myUserAdmin:abc123@127.0.0.1:27017/admin'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Use connect method to connect to the server</span></div><div class="line">MongoClient.connect(url, <span class="function"><span class="keyword">function</span>(<span class="params">err, db</span>) </span>&#123;</div><div class="line">  assert.equal(<span class="literal">null</span>, err);</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"Connected successfully to server"</span>);</div><div class="line">  db.close();</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Connected successfully to server</span></div></pre></td></tr></table></figure></p>
<p>ok，接下来就是看文档的事情了~</p>
</div></article></div></section><footer><div class="paginator"><a href="/date/" class="next">下一篇</a></div><div data-thread-key="mongodb-install/" data-title="mongodb安装教程" data-url="http://yoursite.com/mongodb-install/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"seansun"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com">Oneday</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>